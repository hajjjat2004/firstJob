pipeline {
    
    agent any
  
    stages {
        stage('Checkout Source') {
            steps {
                
               git branch: 'main', credentialsId: 'tokenjenkins', url: 'https://github.com/hajjjat2004/firstjob'
            }
         }
         
        stage('docker compose clean') {
            
           steps{
                
                script {
                  
                   sh '''
                   #!/bin/bash
                   dir=/home/node/dd
                   ssh node@192.168.32.134 /bin/bash << EOF
                   
                            
                   docker system prune -a 
                   docker-compose down
                   docker rm -f $(docker ps -a -q)
                   docker volume rm $(docker volume ls -q)
                   
            
        
                   
                   
                   if [! -d $dir ]
                   then
                   mkdir $dir
                   else
                   rm -r  $dir 
                   mkdir $dir
                   
                   fi
                   cd $dir
                   git clone https://github.com/hajjjat2004/firstjob $dir
                   
                   docker-compose up -d
                   exit 0
                   << EOF
                   
                   '''
                   }
              }
       }     
              
         
    }
}
    
    
