pipeline {
    
    agent any
  
    stages {
        stage('Checkout Source') {
            steps {
                
               git branch: 'main', credentialsId: 'tokenjenkins', url: 'https://github.com/hajjjat2004/firstjob'
            }
         }
         
          stage('docker compose clean') {
            
            steps{
                
                script {
                  
                   sh """
                   #!/bin/bash
                   ssh node@192.168.32.134 /bin/bash << EOF
                   docker system prune -a --volumes -f
                   docker-compose down
                   docker rm -f $(docker ps -a -q)
                   docker volume rm $(docker volume ls -q)
                   if [! -d /home/node/dd ]
                   then
                   mkdir /home/node/dd
                   else
                   mv -b /home/node/dd ~/ 
                   cd /home/node/dd
                   fi
                   git clone https://github.com/hajjjat2004/firstjob /home/node/dd
                   docker-compose up -d
                   exit 0
                   << EOF
                   """
                    
                }
            }
          }
         
    }
}
    
    
